name: "Checks"
on:
  pull_request:
  workflow_call:
  workflow_dispatch:

jobs:
  tests-check:
    name: ü¶Ä Tests Check
    runs-on: ubuntu-latest

    services:
      selenium:
        image: selenium/standalone-firefox:141.0-20250828
        ports:
          - 4444:4444
          - 7900:7900
      minio:
        image: minio/minio:RELEASE.2024-11-07T00-52-20Z.fips
        env:
          MINIO_ROOT_USER: developmentuser
          MINIO_ROOT_PASSWORD: developmentpassword
          MINIO_ADDRESS: ":9000"
          MINIO_CONSOLE_ADDRESS: ":9001"
        ports:
          - 9000:9000
          - 9001:9001
        volumes:
          - minio-storage:/data
        command: server /data

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run `cargo test`
        run: cargo test
        env:
          LETTERBOXD_USERNAME: ${{ secrets.LETTERBOXD_USERNAME }}
          LETTERBOXD_PASSWORD: ${{ secrets.LETTERBOXD_PASSWORD }}
  rustfmt-check:
    name: üëÄ `rustfmt` Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run `cargo fmt`
        run: cargo fmt -- --check
  clippy-check:
    name: üßê Clippy Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run Clippy
        run: cargo clippy
  build-check:
    name: üóø Build Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build
        run: cargo build --release
